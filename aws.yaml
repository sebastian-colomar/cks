#########################################################################
#      Copyright (C) 2025        Sebastian Francisco Colomar Bauza      #
#      SPDX-License-Identifier:  GPL-2.0-only                           #
#########################################################################

---

AWSTemplateFormatVersion: "2010-09-09"

Description: This template creates a new VPC and deploys a HA cluster in AWS

#============================================================
# UI Definition
#============================================================
Metadata:
  AWS::CloudFormation::Interface:
    ParameterGroups:
      -
        Label:
          default: Cluster Master Configuration
        Parameters:
          - InstanceMasterImageId
          - InstanceMasterInstanceType
          - InstanceMasterVolumeSize
      -
        Label:
          default: Cluster Worker Configuration
        Parameters:
          - InstanceWorkerImageId
          - InstanceWorkerInstanceType
          - InstanceWorkerVolumeSize
      -
        Label:
          default: Network Configuration
        Parameters:
          - HostedZoneName
          - PrivateIpAddressInstanceMaster0
          - PrivateIpAddressInstanceMaster1
          - PrivateIpAddressInstanceMaster2
          - PrivateIpAddressInstanceMaster3
          - PrivateIpAddressInstanceMaster4
          - PrivateIpAddressInstanceMaster5
          - PrivateIpAddressInstanceMaster6
          - PrivateIpAddressInstanceMaster7
          - PrivateIpAddressInstanceMaster8
          - PrivateIpAddressInstanceMaster9
          - PrivateIpAddressInstanceMaster10
          - PrivateIpAddressInstanceMaster11
          - PrivateIpAddressInstanceMaster12
          - PrivateIpAddressInstanceMaster13
          - PrivateIpAddressInstanceMaster14
          - PrivateIpAddressInstanceMaster15
          - PrivateIpAddressInstanceMaster16
          - PrivateIpAddressInstanceMaster17
          - PrivateIpAddressInstanceMaster18
          - PrivateIpAddressInstanceMaster19
          - PrivateIpAddressInstanceMaster20
          - PrivateIpAddressInstanceMaster21
          - PrivateIpAddressInstanceMaster22
          - PrivateIpAddressInstanceWorker0
          - PrivateIpAddressInstanceWorker1
          - PrivateIpAddressInstanceWorker2
          - PrivateIpAddressInstanceWorker3
          - PrivateIpAddressInstanceWorker4
          - PrivateIpAddressInstanceWorker5
          - PrivateIpAddressInstanceWorker6
          - PrivateIpAddressInstanceWorker7
          - PrivateIpAddressInstanceWorker8
          - PrivateIpAddressInstanceWorker9
          - PrivateIpAddressInstanceWorker10
          - PrivateIpAddressInstanceWorker11
          - PrivateIpAddressInstanceWorker12
          - PrivateIpAddressInstanceWorker13
          - PrivateIpAddressInstanceWorker14
          - PrivateIpAddressInstanceWorker15
          - PrivateIpAddressInstanceWorker16
          - PrivateIpAddressInstanceWorker17
          - PrivateIpAddressInstanceWorker18
          - PrivateIpAddressInstanceWorker19
          - PrivateIpAddressInstanceWorker20
          - PrivateIpAddressInstanceWorker21
          - PrivateIpAddressInstanceWorker22
          - SecurityGroupCidrIp
          - SubnetCidrBlockPublic
          - VPCCidrBlock
      -
        Label:
          default: Security Configuration
        Parameters:
          - KeyPair1PublicKeyMaterial
          - KeyPair2PublicKeyMaterial

    ParameterLabels:
      HostedZoneName:
        default: The name of the hosted zone that you want to create records in
      InstanceMasterImageId:
        default: AMI to use for Cluster Master Instances
      InstanceMasterInstanceType:
        default: Cluster Master Instance Size
      InstanceMasterVolumeSize:
        default: Cluster Master Volume Size
      InstanceWorkerImageId:
        default: AMI to use for Cluster Worker Instances
      InstanceWorkerInstanceType:
        default: Cluster Worker Instance Size
      InstanceWorkerVolumeSize:
        default: Cluster Worker Volume Size
      KeyPair1PublicKeyMaterial:
        default: Public SSH key 1
      KeyPair2PublicKeyMaterial:
        default: Public SSH key 2
      PrivateIpAddressInstanceMaster0:
        default: The private IP address for Master 0
      PrivateIpAddressInstanceMaster1:
        default: The private IP address for Master 1
      PrivateIpAddressInstanceMaster2:
        default: The private IP address for Master 2
      PrivateIpAddressInstanceMaster3:
        default: The private IP address for Master 3
      PrivateIpAddressInstanceMaster4:
        default: The private IP address for Master 4
      PrivateIpAddressInstanceMaster5:
        default: The private IP address for Master 5
      PrivateIpAddressInstanceMaster6:
        default: The private IP address for Master 6
      PrivateIpAddressInstanceMaster7:
        default: The private IP address for Master 7
      PrivateIpAddressInstanceMaster8:
        default: The private IP address for Master 8
      PrivateIpAddressInstanceMaster9:
        default: The private IP address for Master 9
      PrivateIpAddressInstanceMaster10:
        default: The private IP address for Master 10
      PrivateIpAddressInstanceMaster11:
        default: The private IP address for Master 11
      PrivateIpAddressInstanceMaster12:
        default: The private IP address for Master 12
      PrivateIpAddressInstanceMaster13:
        default: The private IP address for Master 13
      PrivateIpAddressInstanceMaster14:
        default: The private IP address for Master 14
      PrivateIpAddressInstanceMaster15:
        default: The private IP address for Master 15
      PrivateIpAddressInstanceMaster16:
        default: The private IP address for Master 16
      PrivateIpAddressInstanceMaster17:
        default: The private IP address for Master 17
      PrivateIpAddressInstanceMaster18:
        default: The private IP address for Master 18
      PrivateIpAddressInstanceMaster19:
        default: The private IP address for Master 19
      PrivateIpAddressInstanceMaster20:
        default: The private IP address for Master 20
      PrivateIpAddressInstanceMaster21:
        default: The private IP address for Master 21
      PrivateIpAddressInstanceMaster22:
        default: The private IP address for Master 22
      PrivateIpAddressInstanceWorker0:
        default: The private IP address for Worker 0
      PrivateIpAddressInstanceWorker1:
        default: The private IP address for Worker 1
      PrivateIpAddressInstanceWorker2:
        default: The private IP address for Worker 2
      PrivateIpAddressInstanceWorker3:
        default: The private IP address for Worker 3
      PrivateIpAddressInstanceWorker4:
        default: The private IP address for Worker 4
      PrivateIpAddressInstanceWorker5:
        default: The private IP address for Worker 5
      PrivateIpAddressInstanceWorker6:
        default: The private IP address for Worker 6
      PrivateIpAddressInstanceWorker7:
        default: The private IP address for Worker 7
      PrivateIpAddressInstanceWorker8:
        default: The private IP address for Worker 8
      PrivateIpAddressInstanceWorker9:
        default: The private IP address for Worker 9
      PrivateIpAddressInstanceWorker10:
        default: The private IP address for Worker 10
      PrivateIpAddressInstanceWorker11:
        default: The private IP address for Worker 11
      PrivateIpAddressInstanceWorker12:
        default: The private IP address for Worker 12
      PrivateIpAddressInstanceWorker13:
        default: The private IP address for Worker 13
      PrivateIpAddressInstanceWorker14:
        default: The private IP address for Worker 14
      PrivateIpAddressInstanceWorker15:
        default: The private IP address for Worker 15
      PrivateIpAddressInstanceWorker16:
        default: The private IP address for Worker 16
      PrivateIpAddressInstanceWorker17:
        default: The private IP address for Worker 17
      PrivateIpAddressInstanceWorker18:
        default: The private IP address for Worker 18
      PrivateIpAddressInstanceWorker19:
        default: The private IP address for Worker 19
      PrivateIpAddressInstanceWorker20:
        default: The private IP address for Worker 20
      PrivateIpAddressInstanceWorker21:
        default: The private IP address for Worker 21
      PrivateIpAddressInstanceWorker22:
        default: The private IP address for Worker 22
      SecurityGroupCidrIp:
        default: Allowed CIDR for SSH EC2 instance Access
      SubnetCidrBlockPublic:
        default: Public Subnet CIDR
      VPCCidrBlock:
        default: VPC CIDR

Parameters:

  HostedZoneName:
    Default: 'sebastian-colomar.es'
    Description: >
      The name of the hosted zone that you want to create records in.
    Type: String

  InstanceMasterImageId:
    Default: ami-02b8269d5e85954ef #MUMBAI #UBUNTU24
    Description: >
      Select AMI to use for the Cluster Master instances.
      When it's left blank, the default AMI for your AWS region will be used.
      When setting an AMI, it must be available in your current region.
    Type: String

  InstanceMasterInstanceType:
    Default: 't3a.small'
    Description: >
      Select Amazon EC2 instance type for the Cluster Master instances.
    Type: String

  InstanceWorkerImageId:
    Default: ami-02b8269d5e85954ef #MUMBAI #UBUNTU24
    Description: >
      Select AMI to use for the Cluster Worker instances.
      When it's left blank, the default AMI for your AWS region will be used.
      When setting an AMI, it must be available in your current region.
    Type: String

  InstanceWorkerInstanceType:
    Default: 't3a.small'
    Description: >
      Select Amazon EC2 instance type for the Cluster Worker instances.
    Type: String

  KeyPair1PublicKeyMaterial:
    Default: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQD+jz+hUdltY1wBrLs5D0Or6xaLBvTbfa/933B8IxKueX+Vh6GiBbF7xqag7UkBjgCCkG07dIzWRgodtR8worBxz81FL3r+ye60arOVMp3PIQo6LNIJrc4xrFghhzIQKLDDWgQZb3kiHkIBwBL74ez+q7UUSn3Bcyl8UWT3RxsSY968AD284Vld2Dz2i6tyR46CchuQASsswrPCE4y6t/5nJYOJniPGATICVenPAg6SPqXqFNkbDdsVGe0U3deTZvtBubB/tsoKzddZgqC8RkYcOTo07paqUq0Dui0AJDp6V90ziyaVdvG/WWUGjEL9fxJ5HNq5lXObU2fbegcNqhThn+U1r857AlmjyGcowTNZYfSN7Woh4mGHpPfmetfBnj/KWodiomTH1zzrS5lrFxlWPwzJYtcXyU5WOUYiIkRKzC0EgF3H8m2vvvCpaZItww0C7X7DTKnrOBYry67nvi8UgSSE2kHI8BzaqKX78BufAOGjeVhyqLMRammFNP8ILCE=
    Description: >
      Public SSH key 1
    Type: String

  KeyPair2PublicKeyMaterial:
    Default: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQD+jz+hUdltY1wBrLs5D0Or6xaLBvTbfa/933B8IxKueX+Vh6GiBbF7xqag7UkBjgCCkG07dIzWRgodtR8worBxz81FL3r+ye60arOVMp3PIQo6LNIJrc4xrFghhzIQKLDDWgQZb3kiHkIBwBL74ez+q7UUSn3Bcyl8UWT3RxsSY968AD284Vld2Dz2i6tyR46CchuQASsswrPCE4y6t/5nJYOJniPGATICVenPAg6SPqXqFNkbDdsVGe0U3deTZvtBubB/tsoKzddZgqC8RkYcOTo07paqUq0Dui0AJDp6V90ziyaVdvG/WWUGjEL9fxJ5HNq5lXObU2fbegcNqhThn+U1r857AlmjyGcowTNZYfSN7Woh4mGHpPfmetfBnj/KWodiomTH1zzrS5lrFxlWPwzJYtcXyU5WOUYiIkRKzC0EgF3H8m2vvvCpaZItww0C7X7DTKnrOBYry67nvi8UgSSE2kHI8BzaqKX78BufAOGjeVhyqLMRammFNP8ILCE=
    Description: >
      Public SSH key 2
    Type: String

  PrivateIpAddressInstanceMaster0:
    Default: 10.168.2.100
    Description: >
      The private IP address for Master 0.
    Type: String

  PrivateIpAddressInstanceMaster1:
    Default: 10.168.2.101
    Description: >
      The private IP address for Master 1.
    Type: String

  PrivateIpAddressInstanceMaster2:
    Default: 10.168.2.102
    Description: >
      The private IP address for Master 2.
    Type: String

  PrivateIpAddressInstanceMaster3:
    Default: 10.168.2.103
    Description: >
      The private IP address for Master 3.
    Type: String

  PrivateIpAddressInstanceMaster4:
    Default: 10.168.2.104
    Description: >
      The private IP address for Master 4.
    Type: String

  PrivateIpAddressInstanceMaster5:
    Default: 10.168.2.105
    Description: >
      The private IP address for Master 5.
    Type: String

  PrivateIpAddressInstanceMaster6:
    Default: 10.168.2.106
    Description: >
      The private IP address for Master 6.
    Type: String

  PrivateIpAddressInstanceMaster7:
    Default: 10.168.2.107
    Description: >
      The private IP address for Master 7.
    Type: String

  PrivateIpAddressInstanceMaster8:
    Default: 10.168.2.108
    Description: >
      The private IP address for Master 8.
    Type: String

  PrivateIpAddressInstanceMaster9:
    Default: 10.168.2.109
    Description: >
      The private IP address for Master 9.
    Type: String

  PrivateIpAddressInstanceMaster10:
    Default: 10.168.2.110
    Description: >
      The private IP address for Master 10.
    Type: String

  PrivateIpAddressInstanceMaster11:
    Default: 10.168.2.111
    Description: >
      The private IP address for Master 11.
    Type: String

  PrivateIpAddressInstanceMaster12:
    Default: 10.168.2.112
    Description: >
      The private IP address for Master 12.
    Type: String

  PrivateIpAddressInstanceMaster13:
    Default: 10.168.2.113
    Description: >
      The private IP address for Master 13.
    Type: String

  PrivateIpAddressInstanceMaster14:
    Default: 10.168.2.114
    Description: >
      The private IP address for Master 14.
    Type: String

  PrivateIpAddressInstanceMaster15:
    Default: 10.168.2.115
    Description: >
      The private IP address for Master 15.
    Type: String

  PrivateIpAddressInstanceMaster16:
    Default: 10.168.2.116
    Description: >
      The private IP address for Master 16.
    Type: String

  PrivateIpAddressInstanceMaster17:
    Default: 10.168.2.117
    Description: >
      The private IP address for Master 17.
    Type: String

  PrivateIpAddressInstanceMaster18:
    Default: 10.168.2.118
    Description: >
      The private IP address for Master 18.
    Type: String

  PrivateIpAddressInstanceMaster19:
    Default: 10.168.2.119
    Description: >
      The private IP address for Master 19.
    Type: String

  PrivateIpAddressInstanceMaster20:
    Default: 10.168.2.120
    Description: >
      The private IP address for Master 20.
    Type: String

  PrivateIpAddressInstanceMaster21:
    Default: 10.168.2.121
    Description: >
      The private IP address for Master 21.
    Type: String

  PrivateIpAddressInstanceMaster22:
    Default: 10.168.2.122
    Description: >
      The private IP address for Master 22.
    Type: String

  PrivateIpAddressInstanceWorker0:
    Default: 10.168.2.200
    Description: >
      The private IP address for Worker 0.
    Type: String

  PrivateIpAddressInstanceWorker1:
    Default: 10.168.2.201
    Description: >
      The private IP address for Worker 1.
    Type: String

  PrivateIpAddressInstanceWorker2:
    Default: 10.168.2.202
    Description: >
      The private IP address for Worker 2.
    Type: String

  PrivateIpAddressInstanceWorker3:
    Default: 10.168.2.203
    Description: >
      The private IP address for Worker 3.
    Type: String

  PrivateIpAddressInstanceWorker4:
    Default: 10.168.2.204
    Description: >
      The private IP address for Worker 4.
    Type: String

  PrivateIpAddressInstanceWorker5:
    Default: 10.168.2.205
    Description: >
      The private IP address for Worker 5.
    Type: String

  PrivateIpAddressInstanceWorker6:
    Default: 10.168.2.206
    Description: >
      The private IP address for Worker 6.
    Type: String

  PrivateIpAddressInstanceWorker7:
    Default: 10.168.2.207
    Description: >
      The private IP address for Worker 7.
    Type: String

  PrivateIpAddressInstanceWorker8:
    Default: 10.168.2.208
    Description: >
      The private IP address for Worker 8.
    Type: String

  PrivateIpAddressInstanceWorker9:
    Default: 10.168.2.209
    Description: >
      The private IP address for Worker 9.
    Type: String

  PrivateIpAddressInstanceWorker10:
    Default: 10.168.2.210
    Description: >
      The private IP address for Worker 10.
    Type: String

  PrivateIpAddressInstanceWorker11:
    Default: 10.168.2.211
    Description: >
      The private IP address for Worker 11.
    Type: String

  PrivateIpAddressInstanceWorker12:
    Default: 10.168.2.212
    Description: >
      The private IP address for Worker 12.
    Type: String

  PrivateIpAddressInstanceWorker13:
    Default: 10.168.2.213
    Description: >
      The private IP address for Worker 13.
    Type: String

  PrivateIpAddressInstanceWorker14:
    Default: 10.168.2.214
    Description: >
      The private IP address for Worker 14.
    Type: String

  PrivateIpAddressInstanceWorker15:
    Default: 10.168.2.215
    Description: >
      The private IP address for Worker 15.
    Type: String

  PrivateIpAddressInstanceWorker16:
    Default: 10.168.2.216
    Description: >
      The private IP address for Worker 16.
    Type: String

  PrivateIpAddressInstanceWorker17:
    Default: 10.168.2.217
    Description: >
      The private IP address for Worker 17.
    Type: String

  PrivateIpAddressInstanceWorker18:
    Default: 10.168.2.218
    Description: >
      The private IP address for Worker 18.
    Type: String

  PrivateIpAddressInstanceWorker19:
    Default: 10.168.2.219
    Description: >
      The private IP address for Worker 19.
    Type: String

  PrivateIpAddressInstanceWorker20:
    Default: 10.168.2.220
    Description: >
      The private IP address for Worker 20.
    Type: String

  PrivateIpAddressInstanceWorker21:
    Default: 10.168.2.221
    Description: >
      The private IP address for Worker 21.
    Type: String

  PrivateIpAddressInstanceWorker22:
    Default: 10.168.2.222
    Description: >
      The private IP address for Worker 22.
    Type: String

  SecurityGroupCidrIp:
    Default: 0.0.0.0/0
    Description: >
      Allowed CIDR block for external SSH access to the EC2 instances.
      It defines the block of IPs that can access the EC2 instances.
      Set it to 0.0.0.0/0 to make it accessible from anywhere.
    Type: String

  SubnetCidrBlockPublic:
    Default: 10.168.2.0/24
    Description: >
      CIDR block for public (DMZ) subnet located in Availability Zone 1.
      All resources located on this subnet are provided an IP within this address block.
    Type: String

  VPCCidrBlock:
    Default: 10.168.0.0/16
    Description: >
      CIDR block for the VPC. All the subnets and resources will have an IP within this address block.
    Type: String

#============================================================
# Resources
#============================================================
Resources:

  EIPMaster0:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceMaster0
    Type: AWS::EC2::EIP

  EIPMaster1:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceMaster1
    Type: AWS::EC2::EIP

  EIPMaster2:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceMaster2
    Type: AWS::EC2::EIP

  EIPMaster3:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceMaster3
    Type: AWS::EC2::EIP

  EIPMaster4:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceMaster4
    Type: AWS::EC2::EIP

  EIPMaster5:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceMaster5
    Type: AWS::EC2::EIP

  EIPMaster6:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceMaster6
    Type: AWS::EC2::EIP

  EIPMaster7:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceMaster7
    Type: AWS::EC2::EIP

  EIPMaster8:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceMaster8
    Type: AWS::EC2::EIP

  EIPMaster9:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceMaster9
    Type: AWS::EC2::EIP

  EIPMaster10:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceMaster10
    Type: AWS::EC2::EIP

  EIPMaster11:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceMaster11
    Type: AWS::EC2::EIP

  EIPMaster12:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceMaster12
    Type: AWS::EC2::EIP

  EIPMaster13:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceMaster13
    Type: AWS::EC2::EIP

  EIPMaster14:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceMaster14
    Type: AWS::EC2::EIP

  EIPMaster15:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceMaster15
    Type: AWS::EC2::EIP

  EIPMaster16:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceMaster16
    Type: AWS::EC2::EIP

  EIPMaster17:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceMaster17
    Type: AWS::EC2::EIP

  EIPMaster18:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceMaster18
    Type: AWS::EC2::EIP

  EIPMaster19:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceMaster19
    Type: AWS::EC2::EIP

  EIPMaster20:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceMaster20
    Type: AWS::EC2::EIP

  EIPMaster21:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceMaster21
    Type: AWS::EC2::EIP

  EIPMaster22:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceMaster22
    Type: AWS::EC2::EIP

  EIPWorker0:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceWorker0
    Type: AWS::EC2::EIP

  EIPWorker1:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceWorker1
    Type: AWS::EC2::EIP

  EIPWorker2:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceWorker2
    Type: AWS::EC2::EIP

  EIPWorker3:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceWorker3
    Type: AWS::EC2::EIP

  EIPWorker4:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceWorker4
    Type: AWS::EC2::EIP

  EIPWorker5:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceWorker5
    Type: AWS::EC2::EIP

  EIPWorker6:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceWorker6
    Type: AWS::EC2::EIP

  EIPWorker7:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceWorker7
    Type: AWS::EC2::EIP

  EIPWorker8:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceWorker8
    Type: AWS::EC2::EIP

  EIPWorker9:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceWorker9
    Type: AWS::EC2::EIP

  EIPWorker10:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceWorker10
    Type: AWS::EC2::EIP

  EIPWorker11:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceWorker11
    Type: AWS::EC2::EIP

  EIPWorker12:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceWorker12
    Type: AWS::EC2::EIP

  EIPWorker13:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceWorker13
    Type: AWS::EC2::EIP

  EIPWorker14:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceWorker14
    Type: AWS::EC2::EIP

  EIPWorker15:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceWorker15
    Type: AWS::EC2::EIP

  EIPWorker16:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceWorker16
    Type: AWS::EC2::EIP

  EIPWorker17:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceWorker17
    Type: AWS::EC2::EIP

  EIPWorker18:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceWorker18
    Type: AWS::EC2::EIP

  EIPWorker19:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceWorker19
    Type: AWS::EC2::EIP

  EIPWorker20:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceWorker20
    Type: AWS::EC2::EIP

  EIPWorker21:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceWorker21
    Type: AWS::EC2::EIP

  EIPWorker22:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceWorker22
    Type: AWS::EC2::EIP

  InstanceMaster0:
    Properties:
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceMasterImageId
      InstanceType: !Ref InstanceMasterInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceMaster0
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      UserData:
        'Fn::Base64': !Sub |
          users:
            - default
            - name: ubuntu
              ssh_authorized_keys:
                - ${KeyPair1PublicKeyMaterial}
                - ${KeyPair2PublicKeyMaterial}
      Tags:
        - Key: Name
          Value: !Sub "master0.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceMaster1:
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceMasterImageId
      InstanceType: !Ref InstanceMasterInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceMaster1
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      UserData:
        'Fn::Base64': !Sub |
          users:
            - default
            - name: ubuntu
              ssh_authorized_keys:
                - ${KeyPair1PublicKeyMaterial}
                - ${KeyPair2PublicKeyMaterial}
      Tags:
        - Key: Name
          Value: !Sub "master1.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceMaster2:
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceMasterImageId
      InstanceType: !Ref InstanceMasterInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceMaster2
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      UserData:
        'Fn::Base64': !Sub |
          users:
            - default
            - name: ubuntu
              ssh_authorized_keys:
                - ${KeyPair1PublicKeyMaterial}
                - ${KeyPair2PublicKeyMaterial}
      Tags:
        - Key: Name
          Value: !Sub "master2.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceMaster3:
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceMasterImageId
      InstanceType: !Ref InstanceMasterInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceMaster3
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      UserData:
        'Fn::Base64': !Sub |
          users:
            - default
            - name: ubuntu
              ssh_authorized_keys:
                - ${KeyPair1PublicKeyMaterial}
                - ${KeyPair2PublicKeyMaterial}
      Tags:
        - Key: Name
          Value: !Sub "master3.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceMaster4:
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceMasterImageId
      InstanceType: !Ref InstanceMasterInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceMaster4
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      UserData:
        'Fn::Base64': !Sub |
          users:
            - default
            - name: ubuntu
              ssh_authorized_keys:
                - ${KeyPair1PublicKeyMaterial}
                - ${KeyPair2PublicKeyMaterial}
      Tags:
        - Key: Name
          Value: !Sub "master4.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceMaster5:
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceMasterImageId
      InstanceType: !Ref InstanceMasterInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceMaster5
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      UserData:
        'Fn::Base64': !Sub |
          users:
            - default
            - name: ubuntu
              ssh_authorized_keys:
                - ${KeyPair1PublicKeyMaterial}
                - ${KeyPair2PublicKeyMaterial}
      Tags:
        - Key: Name
          Value: !Sub "master5.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceMaster6:
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceMasterImageId
      InstanceType: !Ref InstanceMasterInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceMaster6
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      UserData:
        'Fn::Base64': !Sub |
          users:
            - default
            - name: ubuntu
              ssh_authorized_keys:
                - ${KeyPair1PublicKeyMaterial}
                - ${KeyPair2PublicKeyMaterial}
      Tags:
        - Key: Name
          Value: !Sub "master6.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceMaster7:
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceMasterImageId
      InstanceType: !Ref InstanceMasterInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceMaster7
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      UserData:
        'Fn::Base64': !Sub |
          users:
            - default
            - name: ubuntu
              ssh_authorized_keys:
                - ${KeyPair1PublicKeyMaterial}
                - ${KeyPair2PublicKeyMaterial}
      Tags:
        - Key: Name
          Value: !Sub "master7.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceMaster8:
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceMasterImageId
      InstanceType: !Ref InstanceMasterInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceMaster8
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      UserData:
        'Fn::Base64': !Sub |
          users:
            - default
            - name: ubuntu
              ssh_authorized_keys:
                - ${KeyPair1PublicKeyMaterial}
                - ${KeyPair2PublicKeyMaterial}
      Tags:
        - Key: Name
          Value: !Sub "master8.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceMaster9:
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceMasterImageId
      InstanceType: !Ref InstanceMasterInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceMaster9
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      UserData:
        'Fn::Base64': !Sub |
          users:
            - default
            - name: ubuntu
              ssh_authorized_keys:
                - ${KeyPair1PublicKeyMaterial}
                - ${KeyPair2PublicKeyMaterial}
      Tags:
        - Key: Name
          Value: !Sub "master9.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceMaster10:
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceMasterImageId
      InstanceType: !Ref InstanceMasterInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceMaster10
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      UserData:
        'Fn::Base64': !Sub |
          users:
            - default
            - name: ubuntu
              ssh_authorized_keys:
                - ${KeyPair1PublicKeyMaterial}
                - ${KeyPair2PublicKeyMaterial}
      Tags:
        - Key: Name
          Value: !Sub "master10.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceMaster11:
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceMasterImageId
      InstanceType: !Ref InstanceMasterInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceMaster11
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      UserData:
        'Fn::Base64': !Sub |
          users:
            - default
            - name: ubuntu
              ssh_authorized_keys:
                - ${KeyPair1PublicKeyMaterial}
                - ${KeyPair2PublicKeyMaterial}
      Tags:
        - Key: Name
          Value: !Sub "master11.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceMaster12:
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceMasterImageId
      InstanceType: !Ref InstanceMasterInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceMaster12
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      UserData:
        'Fn::Base64': !Sub |
          users:
            - default
            - name: ubuntu
              ssh_authorized_keys:
                - ${KeyPair1PublicKeyMaterial}
                - ${KeyPair2PublicKeyMaterial}
      Tags:
        - Key: Name
          Value: !Sub "master12.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceMaster13:
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceMasterImageId
      InstanceType: !Ref InstanceMasterInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceMaster13
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      UserData:
        'Fn::Base64': !Sub |
          users:
            - default
            - name: ubuntu
              ssh_authorized_keys:
                - ${KeyPair1PublicKeyMaterial}
                - ${KeyPair2PublicKeyMaterial}
      Tags:
        - Key: Name
          Value: !Sub "master13.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceMaster14:
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceMasterImageId
      InstanceType: !Ref InstanceMasterInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceMaster14
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      UserData:
        'Fn::Base64': !Sub |
          users:
            - default
            - name: ubuntu
              ssh_authorized_keys:
                - ${KeyPair1PublicKeyMaterial}
                - ${KeyPair2PublicKeyMaterial}
      Tags:
        - Key: Name
          Value: !Sub "master14.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceMaster15:
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceMasterImageId
      InstanceType: !Ref InstanceMasterInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceMaster15
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      UserData:
        'Fn::Base64': !Sub |
          users:
            - default
            - name: ubuntu
              ssh_authorized_keys:
                - ${KeyPair1PublicKeyMaterial}
                - ${KeyPair2PublicKeyMaterial}
      Tags:
        - Key: Name
          Value: !Sub "master15.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceMaster16:
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceMasterImageId
      InstanceType: !Ref InstanceMasterInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceMaster16
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      UserData:
        'Fn::Base64': !Sub |
          users:
            - default
            - name: ubuntu
              ssh_authorized_keys:
                - ${KeyPair1PublicKeyMaterial}
                - ${KeyPair2PublicKeyMaterial}
      Tags:
        - Key: Name
          Value: !Sub "master16.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceMaster17:
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceMasterImageId
      InstanceType: !Ref InstanceMasterInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceMaster17
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      UserData:
        'Fn::Base64': !Sub |
          users:
            - default
            - name: ubuntu
              ssh_authorized_keys:
                - ${KeyPair1PublicKeyMaterial}
                - ${KeyPair2PublicKeyMaterial}
      Tags:
        - Key: Name
          Value: !Sub "master17.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceMaster18:
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceMasterImageId
      InstanceType: !Ref InstanceMasterInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceMaster18
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      UserData:
        'Fn::Base64': !Sub |
          users:
            - default
            - name: ubuntu
              ssh_authorized_keys:
                - ${KeyPair1PublicKeyMaterial}
                - ${KeyPair2PublicKeyMaterial}
      Tags:
        - Key: Name
          Value: !Sub "master18.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceMaster19:
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceMasterImageId
      InstanceType: !Ref InstanceMasterInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceMaster19
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      UserData:
        'Fn::Base64': !Sub |
          users:
            - default
            - name: ubuntu
              ssh_authorized_keys:
                - ${KeyPair1PublicKeyMaterial}
                - ${KeyPair2PublicKeyMaterial}
      Tags:
        - Key: Name
          Value: !Sub "master19.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceMaster20:
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceMasterImageId
      InstanceType: !Ref InstanceMasterInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceMaster20
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      UserData:
        'Fn::Base64': !Sub |
          users:
            - default
            - name: ubuntu
              ssh_authorized_keys:
                - ${KeyPair1PublicKeyMaterial}
                - ${KeyPair2PublicKeyMaterial}
      Tags:
        - Key: Name
          Value: !Sub "master20.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceMaster21:
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceMasterImageId
      InstanceType: !Ref InstanceMasterInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceMaster21
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      UserData:
        'Fn::Base64': !Sub |
          users:
            - default
            - name: ubuntu
              ssh_authorized_keys:
                - ${KeyPair1PublicKeyMaterial}
                - ${KeyPair2PublicKeyMaterial}
      Tags:
        - Key: Name
          Value: !Sub "master21.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceMaster22:
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceMasterImageId
      InstanceType: !Ref InstanceMasterInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceMaster22
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      UserData:
        'Fn::Base64': !Sub |
          users:
            - default
            - name: ubuntu
              ssh_authorized_keys:
                - ${KeyPair1PublicKeyMaterial}
                - ${KeyPair2PublicKeyMaterial}
      Tags:
        - Key: Name
          Value: !Sub "master22.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceProfile:
    Properties:
      Roles: [!Ref Role]
    Type: AWS::IAM::InstanceProfile

  InstanceWorker0:
    DependsOn: [VPCGatewayAttachment]
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceWorkerImageId
      InstanceType: !Ref InstanceWorkerInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceWorker0
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      UserData:
        'Fn::Base64': !Sub |
          users:
            - default
            - name: ubuntu
              ssh_authorized_keys:
                - ${KeyPair1PublicKeyMaterial}
                - ${KeyPair2PublicKeyMaterial}
      Tags:
        - Key: Name
          Value: !Sub "worker0.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceWorker1:
    DependsOn: [VPCGatewayAttachment]
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceWorkerImageId
      InstanceType: !Ref InstanceWorkerInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceWorker1
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      UserData:
        'Fn::Base64': !Sub |
          users:
            - default
            - name: ubuntu
              ssh_authorized_keys:
                - ${KeyPair1PublicKeyMaterial}
                - ${KeyPair2PublicKeyMaterial}
      Tags:
        - Key: Name
          Value: !Sub "worker1.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceWorker2:
    DependsOn: [VPCGatewayAttachment]
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceWorkerImageId
      InstanceType: !Ref InstanceWorkerInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceWorker2
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      UserData:
        'Fn::Base64': !Sub |
          users:
            - default
            - name: ubuntu
              ssh_authorized_keys:
                - ${KeyPair1PublicKeyMaterial}
                - ${KeyPair2PublicKeyMaterial}
      Tags:
        - Key: Name
          Value: !Sub "worker2.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceWorker3:
    DependsOn: [VPCGatewayAttachment]
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceWorkerImageId
      InstanceType: !Ref InstanceWorkerInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceWorker3
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      UserData:
        'Fn::Base64': !Sub |
          users:
            - default
            - name: ubuntu
              ssh_authorized_keys:
                - ${KeyPair1PublicKeyMaterial}
                - ${KeyPair2PublicKeyMaterial}
      Tags:
        - Key: Name
          Value: !Sub "worker3.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceWorker4:
    DependsOn: [VPCGatewayAttachment]
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceWorkerImageId
      InstanceType: !Ref InstanceWorkerInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceWorker4
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      UserData:
        'Fn::Base64': !Sub |
          users:
            - default
            - name: ubuntu
              ssh_authorized_keys:
                - ${KeyPair1PublicKeyMaterial}
                - ${KeyPair2PublicKeyMaterial}
      Tags:
        - Key: Name
          Value: !Sub "worker4.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceWorker5:
    DependsOn: [VPCGatewayAttachment]
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceWorkerImageId
      InstanceType: !Ref InstanceWorkerInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceWorker5
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      UserData:
        'Fn::Base64': !Sub |
          users:
            - default
            - name: ubuntu
              ssh_authorized_keys:
                - ${KeyPair1PublicKeyMaterial}
                - ${KeyPair2PublicKeyMaterial}
      Tags:
        - Key: Name
          Value: !Sub "worker5.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceWorker6:
    DependsOn: [VPCGatewayAttachment]
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceWorkerImageId
      InstanceType: !Ref InstanceWorkerInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceWorker6
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      UserData:
        'Fn::Base64': !Sub |
          users:
            - default
            - name: ubuntu
              ssh_authorized_keys:
                - ${KeyPair1PublicKeyMaterial}
                - ${KeyPair2PublicKeyMaterial}
      Tags:
        - Key: Name
          Value: !Sub "worker6.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceWorker7:
    DependsOn: [VPCGatewayAttachment]
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceWorkerImageId
      InstanceType: !Ref InstanceWorkerInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceWorker7
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      UserData:
        'Fn::Base64': !Sub |
          users:
            - default
            - name: ubuntu
              ssh_authorized_keys:
                - ${KeyPair1PublicKeyMaterial}
                - ${KeyPair2PublicKeyMaterial}
      Tags:
        - Key: Name
          Value: !Sub "worker7.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceWorker8:
    DependsOn: [VPCGatewayAttachment]
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceWorkerImageId
      InstanceType: !Ref InstanceWorkerInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceWorker8
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      UserData:
        'Fn::Base64': !Sub |
          users:
            - default
            - name: ubuntu
              ssh_authorized_keys:
                - ${KeyPair1PublicKeyMaterial}
                - ${KeyPair2PublicKeyMaterial}
      Tags:
        - Key: Name
          Value: !Sub "worker8.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceWorker9:
    DependsOn: [VPCGatewayAttachment]
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceWorkerImageId
      InstanceType: !Ref InstanceWorkerInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceWorker9
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      UserData:
        'Fn::Base64': !Sub |
          users:
            - default
            - name: ubuntu
              ssh_authorized_keys:
                - ${KeyPair1PublicKeyMaterial}
                - ${KeyPair2PublicKeyMaterial}
      Tags:
        - Key: Name
          Value: !Sub "worker9.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceWorker10:
    DependsOn: [VPCGatewayAttachment]
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceWorkerImageId
      InstanceType: !Ref InstanceWorkerInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceWorker10
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      UserData:
        'Fn::Base64': !Sub |
          users:
            - default
            - name: ubuntu
              ssh_authorized_keys:
                - ${KeyPair1PublicKeyMaterial}
                - ${KeyPair2PublicKeyMaterial}
      Tags:
        - Key: Name
          Value: !Sub "worker10.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceWorker11:
    DependsOn: [VPCGatewayAttachment]
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceWorkerImageId
      InstanceType: !Ref InstanceWorkerInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceWorker11
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      UserData:
        'Fn::Base64': !Sub |
          users:
            - default
            - name: ubuntu
              ssh_authorized_keys:
                - ${KeyPair1PublicKeyMaterial}
                - ${KeyPair2PublicKeyMaterial}
      Tags:
        - Key: Name
          Value: !Sub "worker11.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceWorker12:
    DependsOn: [VPCGatewayAttachment]
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceWorkerImageId
      InstanceType: !Ref InstanceWorkerInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceWorker12
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      UserData:
        'Fn::Base64': !Sub |
          users:
            - default
            - name: ubuntu
              ssh_authorized_keys:
                - ${KeyPair1PublicKeyMaterial}
                - ${KeyPair2PublicKeyMaterial}
      Tags:
        - Key: Name
          Value: !Sub "worker12.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceWorker13:
    DependsOn: [VPCGatewayAttachment]
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceWorkerImageId
      InstanceType: !Ref InstanceWorkerInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceWorker13
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      UserData:
        'Fn::Base64': !Sub |
          users:
            - default
            - name: ubuntu
              ssh_authorized_keys:
                - ${KeyPair1PublicKeyMaterial}
                - ${KeyPair2PublicKeyMaterial}
      Tags:
        - Key: Name
          Value: !Sub "worker13.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceWorker14:
    DependsOn: [VPCGatewayAttachment]
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceWorkerImageId
      InstanceType: !Ref InstanceWorkerInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceWorker14
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      UserData:
        'Fn::Base64': !Sub |
          users:
            - default
            - name: ubuntu
              ssh_authorized_keys:
                - ${KeyPair1PublicKeyMaterial}
                - ${KeyPair2PublicKeyMaterial}
      Tags:
        - Key: Name
          Value: !Sub "worker14.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceWorker15:
    DependsOn: [VPCGatewayAttachment]
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceWorkerImageId
      InstanceType: !Ref InstanceWorkerInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceWorker15
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      UserData:
        'Fn::Base64': !Sub |
          users:
            - default
            - name: ubuntu
              ssh_authorized_keys:
                - ${KeyPair1PublicKeyMaterial}
                - ${KeyPair2PublicKeyMaterial}
      Tags:
        - Key: Name
          Value: !Sub "worker15.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceWorker16:
    DependsOn: [VPCGatewayAttachment]
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceWorkerImageId
      InstanceType: !Ref InstanceWorkerInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceWorker16
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      UserData:
        'Fn::Base64': !Sub |
          users:
            - default
            - name: ubuntu
              ssh_authorized_keys:
                - ${KeyPair1PublicKeyMaterial}
                - ${KeyPair2PublicKeyMaterial}
      Tags:
        - Key: Name
          Value: !Sub "worker16.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceWorker17:
    DependsOn: [VPCGatewayAttachment]
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceWorkerImageId
      InstanceType: !Ref InstanceWorkerInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceWorker17
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      UserData:
        'Fn::Base64': !Sub |
          users:
            - default
            - name: ubuntu
              ssh_authorized_keys:
                - ${KeyPair1PublicKeyMaterial}
                - ${KeyPair2PublicKeyMaterial}
      Tags:
        - Key: Name
          Value: !Sub "worker17.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceWorker18:
    DependsOn: [VPCGatewayAttachment]
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceWorkerImageId
      InstanceType: !Ref InstanceWorkerInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceWorker18
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      UserData:
        'Fn::Base64': !Sub |
          users:
            - default
            - name: ubuntu
              ssh_authorized_keys:
                - ${KeyPair1PublicKeyMaterial}
                - ${KeyPair2PublicKeyMaterial}
      Tags:
        - Key: Name
          Value: !Sub "worker18.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceWorker19:
    DependsOn: [VPCGatewayAttachment]
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceWorkerImageId
      InstanceType: !Ref InstanceWorkerInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceWorker19
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      UserData:
        'Fn::Base64': !Sub |
          users:
            - default
            - name: ubuntu
              ssh_authorized_keys:
                - ${KeyPair1PublicKeyMaterial}
                - ${KeyPair2PublicKeyMaterial}
      Tags:
        - Key: Name
          Value: !Sub "worker19.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceWorker20:
    DependsOn: [VPCGatewayAttachment]
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceWorkerImageId
      InstanceType: !Ref InstanceWorkerInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceWorker20
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      UserData:
        'Fn::Base64': !Sub |
          users:
            - default
            - name: ubuntu
              ssh_authorized_keys:
                - ${KeyPair1PublicKeyMaterial}
                - ${KeyPair2PublicKeyMaterial}
      Tags:
        - Key: Name
          Value: !Sub "worker20.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceWorker21:
    DependsOn: [VPCGatewayAttachment]
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceWorkerImageId
      InstanceType: !Ref InstanceWorkerInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceWorker21
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      UserData:
        'Fn::Base64': !Sub |
          users:
            - default
            - name: ubuntu
              ssh_authorized_keys:
                - ${KeyPair1PublicKeyMaterial}
                - ${KeyPair2PublicKeyMaterial}
      Tags:
        - Key: Name
          Value: !Sub "worker21.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceWorker22:
    DependsOn: [VPCGatewayAttachment]
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceWorkerImageId
      InstanceType: !Ref InstanceWorkerInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceWorker22
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      UserData:
        'Fn::Base64': !Sub |
          users:
            - default
            - name: ubuntu
              ssh_authorized_keys:
                - ${KeyPair1PublicKeyMaterial}
                - ${KeyPair2PublicKeyMaterial}
      Tags:
        - Key: Name
          Value: !Sub "worker22.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InternetGateway:
    Type: AWS::EC2::InternetGateway

  RecordSetMaster0:
    DependsOn: [EIPMaster0]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'master0.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPMaster0
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetMaster1:
    DependsOn: [EIPMaster1]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'master1.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPMaster1
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetMaster2:
    DependsOn: [EIPMaster2]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'master2.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPMaster2
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetMaster3:
    DependsOn: [EIPMaster3]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'master3.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPMaster3
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetMaster4:
    DependsOn: [EIPMaster4]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'master4.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPMaster4
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetMaster5:
    DependsOn: [EIPMaster5]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'master5.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPMaster5
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetMaster6:
    DependsOn: [EIPMaster6]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'master6.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPMaster6
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetMaster7:
    DependsOn: [EIPMaster7]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'master7.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPMaster7
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetMaster8:
    DependsOn: [EIPMaster8]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'master8.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPMaster8
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetMaster9:
    DependsOn: [EIPMaster9]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'master9.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPMaster9
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetMaster10:
    DependsOn: [EIPMaster10]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'master10.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPMaster10
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetMaster11:
    DependsOn: [EIPMaster11]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'master11.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPMaster11
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetMaster12:
    DependsOn: [EIPMaster12]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'master12.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPMaster12
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetMaster13:
    DependsOn: [EIPMaster13]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'master13.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPMaster13
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetMaster14:
    DependsOn: [EIPMaster14]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'master14.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPMaster14
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetMaster15:
    DependsOn: [EIPMaster15]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'master15.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPMaster15
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetMaster16:
    DependsOn: [EIPMaster16]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'master16.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPMaster16
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetMaster17:
    DependsOn: [EIPMaster17]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'master17.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPMaster17
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetMaster18:
    DependsOn: [EIPMaster18]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'master18.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPMaster18
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetMaster19:
    DependsOn: [EIPMaster19]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'master19.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPMaster19
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetMaster20:
    DependsOn: [EIPMaster20]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'master20.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPMaster20
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetMaster21:
    DependsOn: [EIPMaster21]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'master21.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPMaster21
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetMaster22:
    DependsOn: [EIPMaster22]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'master22.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPMaster22
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetWorker0:
    DependsOn: [EIPWorker0]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'worker0.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPWorker0
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetWorker1:
    DependsOn: [EIPWorker1]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'worker1.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPWorker1
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetWorker2:
    DependsOn: [EIPWorker2]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'worker2.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPWorker2
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetWorker3:
    DependsOn: [EIPWorker3]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'worker3.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPWorker3
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetWorker4:
    DependsOn: [EIPWorker4]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'worker4.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPWorker4
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetWorker5:
    DependsOn: [EIPWorker5]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'worker5.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPWorker5
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetWorker6:
    DependsOn: [EIPWorker6]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'worker6.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPWorker6
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetWorker7:
    DependsOn: [EIPWorker7]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'worker7.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPWorker7
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetWorker8:
    DependsOn: [EIPWorker8]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'worker8.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPWorker8
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetWorker9:
    DependsOn: [EIPWorker9]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'worker9.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPWorker9
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetWorker10:
    DependsOn: [EIPWorker10]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'worker10.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPWorker10
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetWorker11:
    DependsOn: [EIPWorker11]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'worker11.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPWorker11
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetWorker12:
    DependsOn: [EIPWorker12]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'worker12.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPWorker12
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetWorker13:
    DependsOn: [EIPWorker13]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'worker13.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPWorker13
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetWorker14:
    DependsOn: [EIPWorker14]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'worker14.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPWorker14
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetWorker15:
    DependsOn: [EIPWorker15]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'worker15.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPWorker15
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetWorker16:
    DependsOn: [EIPWorker16]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'worker16.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPWorker16
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetWorker17:
    DependsOn: [EIPWorker17]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'worker17.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPWorker17
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetWorker18:
    DependsOn: [EIPWorker18]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'worker18.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPWorker18
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetWorker19:
    DependsOn: [EIPWorker19]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'worker19.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPWorker19
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetWorker20:
    DependsOn: [EIPWorker20]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'worker20.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPWorker20
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetWorker21:
    DependsOn: [EIPWorker21]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'worker21.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPWorker21
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetWorker22:
    DependsOn: [EIPWorker22]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'worker22.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPWorker22
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  Role:
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          -
            Action:
              - sts:AssumeRole
            Effect: Allow
            Principal:
              Service:
                - ec2.amazonaws.com
        Version: 2012-10-17
      ManagedPolicyArns:
        - arn:aws:iam::aws:policy/AmazonSSMManagedInstanceCore
    Type: AWS::IAM::Role

  RoutePublic:
    DependsOn: [VPCGatewayAttachment]
    Properties:
      DestinationCidrBlock: 0.0.0.0/0
      GatewayId: !Ref InternetGateway
      RouteTableId: !Ref RouteTablePublic
    Type: AWS::EC2::Route

  RouteTablePublic:
    Properties:
      VpcId: !Ref VPC
    Type: AWS::EC2::RouteTable

  SecurityGroup:
    Properties:
      GroupDescription: Security Group to access via SSH the EC2 Instances
      SecurityGroupIngress:
        -
          CidrIp: !Ref SecurityGroupCidrIp
          FromPort: 22
          IpProtocol: tcp
          ToPort: 22
      VpcId: !Ref VPC
    Type: AWS::EC2::SecurityGroup

  SubnetPublic:
    Properties:
      AvailabilityZone:
        Fn::Select:
          - 0
          - Fn::GetAZs: !Ref 'AWS::Region'
      CidrBlock: !Ref SubnetCidrBlockPublic
      VpcId: !Ref VPC
    Type: AWS::EC2::Subnet

  SubnetRouteTableAssociationPublic:
    Properties:
      RouteTableId: !Ref RouteTablePublic
      SubnetId: !Ref SubnetPublic
    Type: AWS::EC2::SubnetRouteTableAssociation

  VPC:
    Properties:
      CidrBlock: !Ref VPCCidrBlock
    Type: "AWS::EC2::VPC"

  VPCGatewayAttachment:
    Properties:
      InternetGatewayId: !Ref InternetGateway
      VpcId: !Ref VPC
    Type: AWS::EC2::VPCGatewayAttachment
