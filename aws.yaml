#########################################################################
#      Copyright (C) 2025        Sebastian Francisco Colomar Bauza      #
#      SPDX-License-Identifier:  GPL-2.0-only                           #
#########################################################################

---

AWSTemplateFormatVersion: "2010-09-09"

Description: This template creates a new VPC and deploys a HA cluster in AWS

#============================================================
# UI Definition
#============================================================
Metadata:
  AWS::CloudFormation::Interface:
    ParameterGroups:
      -
        Label:
          default: Cluster Master Configuration
        Parameters:
          - InstanceMasterImageId
          - InstanceMasterInstanceType
          - InstanceMasterVolumeSize
      -
        Label:
          default: Cluster Worker Configuration
        Parameters:
          - InstanceWorkerImageId
          - InstanceWorkerInstanceType
          - InstanceWorkerVolumeSize
      -
        Label:
          default: Network Configuration
        Parameters:
          - HostedZoneName
          - PrivateIpAddressInstanceMaster00
          - PrivateIpAddressInstanceMaster01
          - PrivateIpAddressInstanceMaster02
          - PrivateIpAddressInstanceMaster03
          - PrivateIpAddressInstanceMaster04
          - PrivateIpAddressInstanceMaster05
          - PrivateIpAddressInstanceMaster06
          - PrivateIpAddressInstanceMaster07
          - PrivateIpAddressInstanceMaster08
          - PrivateIpAddressInstanceMaster09
          - PrivateIpAddressInstanceMaster10
          - PrivateIpAddressInstanceMaster11
          - PrivateIpAddressInstanceMaster12
          - PrivateIpAddressInstanceMaster13
          - PrivateIpAddressInstanceMaster14
          - PrivateIpAddressInstanceMaster15
          - PrivateIpAddressInstanceMaster16
          - PrivateIpAddressInstanceMaster17
          - PrivateIpAddressInstanceMaster18
          - PrivateIpAddressInstanceMaster19
          - PrivateIpAddressInstanceMaster20
          - PrivateIpAddressInstanceMaster21
          - PrivateIpAddressInstanceMaster22
          - PrivateIpAddressInstanceWorker00
          - PrivateIpAddressInstanceWorker01
          - PrivateIpAddressInstanceWorker02
          - PrivateIpAddressInstanceWorker03
          - PrivateIpAddressInstanceWorker04
          - PrivateIpAddressInstanceWorker05
          - PrivateIpAddressInstanceWorker06
          - PrivateIpAddressInstanceWorker07
          - PrivateIpAddressInstanceWorker08
          - PrivateIpAddressInstanceWorker09
          - PrivateIpAddressInstanceWorker10
          - PrivateIpAddressInstanceWorker11
          - PrivateIpAddressInstanceWorker12
          - PrivateIpAddressInstanceWorker13
          - PrivateIpAddressInstanceWorker14
          - PrivateIpAddressInstanceWorker15
          - PrivateIpAddressInstanceWorker16
          - PrivateIpAddressInstanceWorker17
          - PrivateIpAddressInstanceWorker18
          - PrivateIpAddressInstanceWorker19
          - PrivateIpAddressInstanceWorker20
          - PrivateIpAddressInstanceWorker21
          - PrivateIpAddressInstanceWorker22
          - SecurityGroupCidrIp
          - SubnetCidrBlockPublic
          - VPCCidrBlock
      -
        Label:
          default: Security Configuration
        Parameters:
          - KeyPairPublicKeyMaterial

    ParameterLabels:
      HostedZoneName:
        default: The name of the hosted zone that you want to create records in
      InstanceMasterImageId:
        default: AMI to use for Cluster Master Instances
      InstanceMasterInstanceType:
        default: Cluster Master Instance Size
      InstanceMasterVolumeSize:
        default: Cluster Master Volume Size
      InstanceWorkerImageId:
        default: AMI to use for Cluster Worker Instances
      InstanceWorkerInstanceType:
        default: Cluster Worker Instance Size
      InstanceWorkerVolumeSize:
        default: Cluster Worker Volume Size
      KeyPairPublicKeyMaterial:
        default: Public SSH key
      PrivateIpAddressInstanceMaster00:
        default: The private IP address for Master 00
      PrivateIpAddressInstanceMaster01:
        default: The private IP address for Master 01
      PrivateIpAddressInstanceMaster02:
        default: The private IP address for Master 02
      PrivateIpAddressInstanceMaster03:
        default: The private IP address for Master 03
      PrivateIpAddressInstanceMaster04:
        default: The private IP address for Master 04
      PrivateIpAddressInstanceMaster05:
        default: The private IP address for Master 05
      PrivateIpAddressInstanceMaster06:
        default: The private IP address for Master 06
      PrivateIpAddressInstanceMaster07:
        default: The private IP address for Master 07
      PrivateIpAddressInstanceMaster08:
        default: The private IP address for Master 08
      PrivateIpAddressInstanceMaster09:
        default: The private IP address for Master 09
      PrivateIpAddressInstanceMaster10:
        default: The private IP address for Master 10
      PrivateIpAddressInstanceMaster11:
        default: The private IP address for Master 11
      PrivateIpAddressInstanceMaster12:
        default: The private IP address for Master 12
      PrivateIpAddressInstanceMaster13:
        default: The private IP address for Master 13
      PrivateIpAddressInstanceMaster14:
        default: The private IP address for Master 14
      PrivateIpAddressInstanceMaster15:
        default: The private IP address for Master 15
      PrivateIpAddressInstanceMaster16:
        default: The private IP address for Master 16
      PrivateIpAddressInstanceMaster17:
        default: The private IP address for Master 17
      PrivateIpAddressInstanceMaster18:
        default: The private IP address for Master 18
      PrivateIpAddressInstanceMaster19:
        default: The private IP address for Master 19
      PrivateIpAddressInstanceMaster20:
        default: The private IP address for Master 20
      PrivateIpAddressInstanceMaster21:
        default: The private IP address for Master 21
      PrivateIpAddressInstanceMaster22:
        default: The private IP address for Master 22
      PrivateIpAddressInstanceWorker00:
        default: The private IP address for Worker 00
      PrivateIpAddressInstanceWorker01:
        default: The private IP address for Worker 01
      PrivateIpAddressInstanceWorker02:
        default: The private IP address for Worker 02
      PrivateIpAddressInstanceWorker03:
        default: The private IP address for Worker 03
      PrivateIpAddressInstanceWorker04:
        default: The private IP address for Worker 04
      PrivateIpAddressInstanceWorker05:
        default: The private IP address for Worker 05
      PrivateIpAddressInstanceWorker06:
        default: The private IP address for Worker 06
      PrivateIpAddressInstanceWorker07:
        default: The private IP address for Worker 07
      PrivateIpAddressInstanceWorker08:
        default: The private IP address for Worker 08
      PrivateIpAddressInstanceWorker09:
        default: The private IP address for Worker 09
      PrivateIpAddressInstanceWorker10:
        default: The private IP address for Worker 10
      PrivateIpAddressInstanceWorker11:
        default: The private IP address for Worker 11
      PrivateIpAddressInstanceWorker12:
        default: The private IP address for Worker 12
      PrivateIpAddressInstanceWorker13:
        default: The private IP address for Worker 13
      PrivateIpAddressInstanceWorker14:
        default: The private IP address for Worker 14
      PrivateIpAddressInstanceWorker15:
        default: The private IP address for Worker 15
      PrivateIpAddressInstanceWorker16:
        default: The private IP address for Worker 16
      PrivateIpAddressInstanceWorker17:
        default: The private IP address for Worker 17
      PrivateIpAddressInstanceWorker18:
        default: The private IP address for Worker 18
      PrivateIpAddressInstanceWorker19:
        default: The private IP address for Worker 19
      PrivateIpAddressInstanceWorker20:
        default: The private IP address for Worker 20
      PrivateIpAddressInstanceWorker21:
        default: The private IP address for Worker 21
      PrivateIpAddressInstanceWorker22:
        default: The private IP address for Worker 22
      SecurityGroupCidrIp:
        default: Allowed CIDR for SSH EC2 instance Access
      SubnetCidrBlockPublic:
        default: Public Subnet CIDR
      VPCCidrBlock:
        default: VPC CIDR

Parameters:

  HostedZoneName:
    Default: 'sebastian-colomar.es'
    Description: >
      The name of the hosted zone that you want to create records in.
    Type: String

  InstanceMasterImageId:
    Default: ami-02b8269d5e85954ef #MUMBAI #UBUNTU24
    Description: >
      Select AMI to use for the Cluster Master instances.
      When it's left blank, the default AMI for your AWS region will be used.
      When setting an AMI, it must be available in your current region.
    Type: String

  InstanceMasterInstanceType:
    Default: 't3a.small'
    Description: >
      Select Amazon EC2 instance type for the Cluster Master instances.
    Type: String

  InstanceMasterVolumeSize:
    Default: 20
    Description: >
      Select Amazon EC2 volume size for the Cluster Master instances.
    Type: Number

  InstanceWorkerImageId:
    Default: ami-02b8269d5e85954ef #MUMBAI #UBUNTU24
    Description: >
      Select AMI to use for the Cluster Worker instances.
      When it's left blank, the default AMI for your AWS region will be used.
      When setting an AMI, it must be available in your current region.
    Type: String

  InstanceWorkerInstanceType:
    Default: 't3a.small'
    Description: >
      Select Amazon EC2 instance type for the Cluster Worker instances.
    Type: String

  InstanceWorkerVolumeSize:
    Default: 20
    Description: >
      Select Amazon EC2 volume size for the Cluster Worker instances.
    Type: Number

  KeyPairPublicKeyMaterial:
    Default: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQD+jz+hUdltY1wBrLs5D0Or6xaLBvTbfa/933B8IxKueX+Vh6GiBbF7xqag7UkBjgCCkG07dIzWRgodtR8worBxz81FL3r+ye60arOVMp3PIQo6LNIJrc4xrFghhzIQKLDDWgQZb3kiHkIBwBL74ez+q7UUSn3Bcyl8UWT3RxsSY968AD284Vld2Dz2i6tyR46CchuQASsswrPCE4y6t/5nJYOJniPGATICVenPAg6SPqXqFNkbDdsVGe0U3deTZvtBubB/tsoKzddZgqC8RkYcOTo07paqUq0Dui0AJDp6V90ziyaVdvG/WWUGjEL9fxJ5HNq5lXObU2fbegcNqhThn+U1r857AlmjyGcowTNZYfSN7Woh4mGHpPfmetfBnj/KWodiomTH1zzrS5lrFxlWPwzJYtcXyU5WOUYiIkRKzC0EgF3H8m2vvvCpaZItww0C7X7DTKnrOBYry67nvi8UgSSE2kHI8BzaqKX78BufAOGjeVhyqLMRammFNP8ILCE=
    Description: >
      Public SSH key
    Type: String

  PrivateIpAddressInstanceMaster00:
    Default: 10.168.2.100
    Description: >
      The private IP address for Master 00.
    Type: String

  PrivateIpAddressInstanceMaster01:
    Default: 10.168.2.101
    Description: >
      The private IP address for Master 01.
    Type: String

  PrivateIpAddressInstanceMaster02:
    Default: 10.168.2.102
    Description: >
      The private IP address for Master 02.
    Type: String

  PrivateIpAddressInstanceMaster03:
    Default: 10.168.2.103
    Description: >
      The private IP address for Master 03.
    Type: String

  PrivateIpAddressInstanceMaster04:
    Default: 10.168.2.104
    Description: >
      The private IP address for Master 04.
    Type: String

  PrivateIpAddressInstanceMaster05:
    Default: 10.168.2.105
    Description: >
      The private IP address for Master 05.
    Type: String

  PrivateIpAddressInstanceMaster06:
    Default: 10.168.2.106
    Description: >
      The private IP address for Master 06.
    Type: String

  PrivateIpAddressInstanceMaster07:
    Default: 10.168.2.107
    Description: >
      The private IP address for Master 07.
    Type: String

  PrivateIpAddressInstanceMaster08:
    Default: 10.168.2.108
    Description: >
      The private IP address for Master 08.
    Type: String

  PrivateIpAddressInstanceMaster09:
    Default: 10.168.2.109
    Description: >
      The private IP address for Master 09.
    Type: String

  PrivateIpAddressInstanceMaster10:
    Default: 10.168.2.110
    Description: >
      The private IP address for Master 10.
    Type: String

  PrivateIpAddressInstanceMaster11:
    Default: 10.168.2.111
    Description: >
      The private IP address for Master 11.
    Type: String

  PrivateIpAddressInstanceMaster12:
    Default: 10.168.2.112
    Description: >
      The private IP address for Master 12.
    Type: String

  PrivateIpAddressInstanceMaster13:
    Default: 10.168.2.113
    Description: >
      The private IP address for Master 13.
    Type: String

  PrivateIpAddressInstanceMaster14:
    Default: 10.168.2.114
    Description: >
      The private IP address for Master 14.
    Type: String

  PrivateIpAddressInstanceMaster15:
    Default: 10.168.2.115
    Description: >
      The private IP address for Master 15.
    Type: String

  PrivateIpAddressInstanceMaster16:
    Default: 10.168.2.116
    Description: >
      The private IP address for Master 16.
    Type: String

  PrivateIpAddressInstanceMaster17:
    Default: 10.168.2.117
    Description: >
      The private IP address for Master 17.
    Type: String

  PrivateIpAddressInstanceMaster18:
    Default: 10.168.2.118
    Description: >
      The private IP address for Master 18.
    Type: String

  PrivateIpAddressInstanceMaster19:
    Default: 10.168.2.119
    Description: >
      The private IP address for Master 19.
    Type: String

  PrivateIpAddressInstanceMaster20:
    Default: 10.168.2.120
    Description: >
      The private IP address for Master 20.
    Type: String

  PrivateIpAddressInstanceMaster21:
    Default: 10.168.2.121
    Description: >
      The private IP address for Master 21.
    Type: String

  PrivateIpAddressInstanceMaster22:
    Default: 10.168.2.122
    Description: >
      The private IP address for Master 22.
    Type: String

  PrivateIpAddressInstanceWorker00:
    Default: 10.168.2.200
    Description: >
      The private IP address for Worker 00.
    Type: String

  PrivateIpAddressInstanceWorker01:
    Default: 10.168.2.201
    Description: >
      The private IP address for Worker 01.
    Type: String

  PrivateIpAddressInstanceWorker02:
    Default: 10.168.2.202
    Description: >
      The private IP address for Worker 02.
    Type: String

  PrivateIpAddressInstanceWorker03:
    Default: 10.168.2.203
    Description: >
      The private IP address for Worker 03.
    Type: String

  PrivateIpAddressInstanceWorker04:
    Default: 10.168.2.204
    Description: >
      The private IP address for Worker 04.
    Type: String

  PrivateIpAddressInstanceWorker05:
    Default: 10.168.2.205
    Description: >
      The private IP address for Worker 05.
    Type: String

  PrivateIpAddressInstanceWorker06:
    Default: 10.168.2.206
    Description: >
      The private IP address for Worker 06.
    Type: String

  PrivateIpAddressInstanceWorker07:
    Default: 10.168.2.207
    Description: >
      The private IP address for Worker 07.
    Type: String

  PrivateIpAddressInstanceWorker08:
    Default: 10.168.2.208
    Description: >
      The private IP address for Worker 08.
    Type: String

  PrivateIpAddressInstanceWorker09:
    Default: 10.168.2.209
    Description: >
      The private IP address for Worker 09.
    Type: String

  PrivateIpAddressInstanceWorker10:
    Default: 10.168.2.210
    Description: >
      The private IP address for Worker 10.
    Type: String

  PrivateIpAddressInstanceWorker11:
    Default: 10.168.2.211
    Description: >
      The private IP address for Worker 11.
    Type: String

  PrivateIpAddressInstanceWorker12:
    Default: 10.168.2.212
    Description: >
      The private IP address for Worker 12.
    Type: String

  PrivateIpAddressInstanceWorker13:
    Default: 10.168.2.213
    Description: >
      The private IP address for Worker 13.
    Type: String

  PrivateIpAddressInstanceWorker14:
    Default: 10.168.2.214
    Description: >
      The private IP address for Worker 14.
    Type: String

  PrivateIpAddressInstanceWorker15:
    Default: 10.168.2.215
    Description: >
      The private IP address for Worker 15.
    Type: String

  PrivateIpAddressInstanceWorker16:
    Default: 10.168.2.216
    Description: >
      The private IP address for Worker 16.
    Type: String

  PrivateIpAddressInstanceWorker17:
    Default: 10.168.2.217
    Description: >
      The private IP address for Worker 17.
    Type: String

  PrivateIpAddressInstanceWorker18:
    Default: 10.168.2.218
    Description: >
      The private IP address for Worker 18.
    Type: String

  PrivateIpAddressInstanceWorker19:
    Default: 10.168.2.219
    Description: >
      The private IP address for Worker 19.
    Type: String

  PrivateIpAddressInstanceWorker20:
    Default: 10.168.2.220
    Description: >
      The private IP address for Worker 20.
    Type: String

  PrivateIpAddressInstanceWorker21:
    Default: 10.168.2.221
    Description: >
      The private IP address for Worker 21.
    Type: String

  PrivateIpAddressInstanceWorker22:
    Default: 10.168.2.222
    Description: >
      The private IP address for Worker 22.
    Type: String

  SecurityGroupCidrIp:
    Default: 0.0.0.0/0
    Description: >
      Allowed CIDR block for external SSH access to the EC2 instances.
      It defines the block of IPs that can access the EC2 instances.
      Set it to 0.0.0.0/0 to make it accessible from anywhere.
    Type: String

  SubnetCidrBlockPublic:
    Default: 10.168.2.0/24
    Description: >
      CIDR block for public (DMZ) subnet located in Availability Zone 1.
      All resources located on this subnet are provided an IP within this address block.
    Type: String

  VPCCidrBlock:
    Default: 10.168.0.0/16
    Description: >
      CIDR block for the VPC. All the subnets and resources will have an IP within this address block.
    Type: String

#============================================================
# Resources
#============================================================
Resources:

  EIPMaster00:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceMaster00
    Type: AWS::EC2::EIP

  EIPMaster01:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceMaster01
    Type: AWS::EC2::EIP

  EIPMaster02:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceMaster02
    Type: AWS::EC2::EIP

  EIPMaster03:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceMaster03
    Type: AWS::EC2::EIP

  EIPMaster04:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceMaster04
    Type: AWS::EC2::EIP

  EIPMaster05:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceMaster05
    Type: AWS::EC2::EIP

  EIPMaster06:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceMaster06
    Type: AWS::EC2::EIP

  EIPMaster07:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceMaster07
    Type: AWS::EC2::EIP

  EIPMaster08:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceMaster08
    Type: AWS::EC2::EIP

  EIPMaster09:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceMaster09
    Type: AWS::EC2::EIP

  EIPMaster10:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceMaster10
    Type: AWS::EC2::EIP

  EIPMaster11:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceMaster11
    Type: AWS::EC2::EIP

  EIPMaster12:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceMaster12
    Type: AWS::EC2::EIP

  EIPMaster13:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceMaster13
    Type: AWS::EC2::EIP

  EIPMaster14:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceMaster14
    Type: AWS::EC2::EIP

  EIPMaster15:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceMaster15
    Type: AWS::EC2::EIP

  EIPMaster16:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceMaster16
    Type: AWS::EC2::EIP

  EIPMaster17:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceMaster17
    Type: AWS::EC2::EIP

  EIPMaster18:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceMaster18
    Type: AWS::EC2::EIP

  EIPMaster19:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceMaster19
    Type: AWS::EC2::EIP

  EIPMaster20:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceMaster20
    Type: AWS::EC2::EIP

  EIPMaster21:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceMaster21
    Type: AWS::EC2::EIP

  EIPMaster22:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceMaster22
    Type: AWS::EC2::EIP

  EIPWorker00:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceWorker00
    Type: AWS::EC2::EIP

  EIPWorker01:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceWorker01
    Type: AWS::EC2::EIP

  EIPWorker02:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceWorker02
    Type: AWS::EC2::EIP

  EIPWorker03:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceWorker03
    Type: AWS::EC2::EIP

  EIPWorker04:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceWorker04
    Type: AWS::EC2::EIP

  EIPWorker05:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceWorker05
    Type: AWS::EC2::EIP

  EIPWorker06:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceWorker06
    Type: AWS::EC2::EIP

  EIPWorker07:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceWorker07
    Type: AWS::EC2::EIP

  EIPWorker08:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceWorker08
    Type: AWS::EC2::EIP

  EIPWorker09:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceWorker09
    Type: AWS::EC2::EIP

  EIPWorker10:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceWorker10
    Type: AWS::EC2::EIP

  EIPWorker11:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceWorker11
    Type: AWS::EC2::EIP

  EIPWorker12:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceWorker12
    Type: AWS::EC2::EIP

  EIPWorker13:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceWorker13
    Type: AWS::EC2::EIP

  EIPWorker14:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceWorker14
    Type: AWS::EC2::EIP

  EIPWorker15:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceWorker15
    Type: AWS::EC2::EIP

  EIPWorker16:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceWorker16
    Type: AWS::EC2::EIP

  EIPWorker17:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceWorker17
    Type: AWS::EC2::EIP

  EIPWorker18:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceWorker18
    Type: AWS::EC2::EIP

  EIPWorker19:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceWorker19
    Type: AWS::EC2::EIP

  EIPWorker20:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceWorker20
    Type: AWS::EC2::EIP

  EIPWorker21:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceWorker21
    Type: AWS::EC2::EIP

  EIPWorker22:
    Properties:
      Domain: vpc
      InstanceId: !Ref InstanceWorker22
    Type: AWS::EC2::EIP

  InstanceMaster00:
    Properties:
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceMasterImageId
      InstanceType: !Ref InstanceMasterInstanceType
      KeyName: !Ref KeyPair
      PrivateIpAddress: !Ref PrivateIpAddressInstanceMaster00
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      Tags:
        - Key: Name
          Value: !Sub "master00.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceMaster01:
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceMasterImageId
      InstanceType: !Ref InstanceMasterInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceMaster01
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      Tags:
        - Key: Name
          Value: !Sub "master01.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceMaster02:
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceMasterImageId
      InstanceType: !Ref InstanceMasterInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceMaster02
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      Tags:
        - Key: Name
          Value: !Sub "master02.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceMaster03:
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceMasterImageId
      InstanceType: !Ref InstanceMasterInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceMaster03
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      Tags:
        - Key: Name
          Value: !Sub "master03.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceMaster04:
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceMasterImageId
      InstanceType: !Ref InstanceMasterInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceMaster04
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      Tags:
        - Key: Name
          Value: !Sub "master04.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceMaster05:
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceMasterImageId
      InstanceType: !Ref InstanceMasterInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceMaster05
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      Tags:
        - Key: Name
          Value: !Sub "master05.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceMaster06:
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceMasterImageId
      InstanceType: !Ref InstanceMasterInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceMaster06
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      Tags:
        - Key: Name
          Value: !Sub "master06.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceMaster07:
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceMasterImageId
      InstanceType: !Ref InstanceMasterInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceMaster07
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      Tags:
        - Key: Name
          Value: !Sub "master07.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceMaster08:
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceMasterImageId
      InstanceType: !Ref InstanceMasterInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceMaster08
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      Tags:
        - Key: Name
          Value: !Sub "master08.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceMaster09:
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceMasterImageId
      InstanceType: !Ref InstanceMasterInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceMaster09
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      Tags:
        - Key: Name
          Value: !Sub "master09.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceMaster10:
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceMasterImageId
      InstanceType: !Ref InstanceMasterInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceMaster10
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      Tags:
        - Key: Name
          Value: !Sub "master10.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceMaster11:
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceMasterImageId
      InstanceType: !Ref InstanceMasterInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceMaster11
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      Tags:
        - Key: Name
          Value: !Sub "master11.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceMaster12:
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceMasterImageId
      InstanceType: !Ref InstanceMasterInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceMaster12
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      Tags:
        - Key: Name
          Value: !Sub "master12.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceMaster13:
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceMasterImageId
      InstanceType: !Ref InstanceMasterInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceMaster13
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      Tags:
        - Key: Name
          Value: !Sub "master13.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceMaster14:
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceMasterImageId
      InstanceType: !Ref InstanceMasterInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceMaster14
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      Tags:
        - Key: Name
          Value: !Sub "master14.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceMaster15:
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceMasterImageId
      InstanceType: !Ref InstanceMasterInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceMaster15
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      Tags:
        - Key: Name
          Value: !Sub "master15.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceMaster16:
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceMasterImageId
      InstanceType: !Ref InstanceMasterInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceMaster16
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      Tags:
        - Key: Name
          Value: !Sub "master16.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceMaster17:
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceMasterImageId
      InstanceType: !Ref InstanceMasterInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceMaster17
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      Tags:
        - Key: Name
          Value: !Sub "master17.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceMaster18:
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceMasterImageId
      InstanceType: !Ref InstanceMasterInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceMaster18
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      Tags:
        - Key: Name
          Value: !Sub "master18.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceMaster19:
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceMasterImageId
      InstanceType: !Ref InstanceMasterInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceMaster19
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      Tags:
        - Key: Name
          Value: !Sub "master19.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceMaster20:
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceMasterImageId
      InstanceType: !Ref InstanceMasterInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceMaster20
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      Tags:
        - Key: Name
          Value: !Sub "master20.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceMaster21:
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceMasterImageId
      InstanceType: !Ref InstanceMasterInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceMaster21
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      Tags:
        - Key: Name
          Value: !Sub "master21.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceMaster22:
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceMasterImageId
      InstanceType: !Ref InstanceMasterInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceMaster22
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      Tags:
        - Key: Name
          Value: !Sub "master22.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceProfile:
    Properties:
      Roles: [!Ref Role]
    Type: AWS::IAM::InstanceProfile

  InstanceWorker00:
    DependsOn: [VPCGatewayAttachment]
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceWorkerImageId
      InstanceType: !Ref InstanceWorkerInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceWorker00
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      Tags:
        - Key: Name
          Value: !Sub "worker00.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceWorker01:
    DependsOn: [VPCGatewayAttachment]
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceWorkerImageId
      InstanceType: !Ref InstanceWorkerInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceWorker01
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      Tags:
        - Key: Name
          Value: !Sub "worker01.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceWorker02:
    DependsOn: [VPCGatewayAttachment]
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceWorkerImageId
      InstanceType: !Ref InstanceWorkerInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceWorker02
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      Tags:
        - Key: Name
          Value: !Sub "worker02.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceWorker03:
    DependsOn: [VPCGatewayAttachment]
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceWorkerImageId
      InstanceType: !Ref InstanceWorkerInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceWorker03
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      Tags:
        - Key: Name
          Value: !Sub "worker03.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceWorker04:
    DependsOn: [VPCGatewayAttachment]
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceWorkerImageId
      InstanceType: !Ref InstanceWorkerInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceWorker04
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      Tags:
        - Key: Name
          Value: !Sub "worker04.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceWorker05:
    DependsOn: [VPCGatewayAttachment]
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceWorkerImageId
      InstanceType: !Ref InstanceWorkerInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceWorker05
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      Tags:
        - Key: Name
          Value: !Sub "worker05.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceWorker06:
    DependsOn: [VPCGatewayAttachment]
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceWorkerImageId
      InstanceType: !Ref InstanceWorkerInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceWorker06
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      Tags:
        - Key: Name
          Value: !Sub "worker06.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceWorker07:
    DependsOn: [VPCGatewayAttachment]
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceWorkerImageId
      InstanceType: !Ref InstanceWorkerInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceWorker07
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      Tags:
        - Key: Name
          Value: !Sub "worker07.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceWorker08:
    DependsOn: [VPCGatewayAttachment]
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceWorkerImageId
      InstanceType: !Ref InstanceWorkerInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceWorker08
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      Tags:
        - Key: Name
          Value: !Sub "worker08.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceWorker09:
    DependsOn: [VPCGatewayAttachment]
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceWorkerImageId
      InstanceType: !Ref InstanceWorkerInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceWorker09
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      Tags:
        - Key: Name
          Value: !Sub "worker09.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceWorker10:
    DependsOn: [VPCGatewayAttachment]
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceWorkerImageId
      InstanceType: !Ref InstanceWorkerInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceWorker10
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      Tags:
        - Key: Name
          Value: !Sub "worker10.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceWorker11:
    DependsOn: [VPCGatewayAttachment]
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceWorkerImageId
      InstanceType: !Ref InstanceWorkerInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceWorker11
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      Tags:
        - Key: Name
          Value: !Sub "worker11.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceWorker12:
    DependsOn: [VPCGatewayAttachment]
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceWorkerImageId
      InstanceType: !Ref InstanceWorkerInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceWorker12
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      Tags:
        - Key: Name
          Value: !Sub "worker12.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceWorker13:
    DependsOn: [VPCGatewayAttachment]
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceWorkerImageId
      InstanceType: !Ref InstanceWorkerInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceWorker13
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      Tags:
        - Key: Name
          Value: !Sub "worker13.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceWorker14:
    DependsOn: [VPCGatewayAttachment]
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceWorkerImageId
      InstanceType: !Ref InstanceWorkerInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceWorker14
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      Tags:
        - Key: Name
          Value: !Sub "worker14.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceWorker15:
    DependsOn: [VPCGatewayAttachment]
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceWorkerImageId
      InstanceType: !Ref InstanceWorkerInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceWorker15
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      Tags:
        - Key: Name
          Value: !Sub "worker15.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceWorker16:
    DependsOn: [VPCGatewayAttachment]
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceWorkerImageId
      InstanceType: !Ref InstanceWorkerInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceWorker16
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      Tags:
        - Key: Name
          Value: !Sub "worker16.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceWorker17:
    DependsOn: [VPCGatewayAttachment]
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceWorkerImageId
      InstanceType: !Ref InstanceWorkerInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceWorker17
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      Tags:
        - Key: Name
          Value: !Sub "worker17.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceWorker18:
    DependsOn: [VPCGatewayAttachment]
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceWorkerImageId
      InstanceType: !Ref InstanceWorkerInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceWorker18
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      Tags:
        - Key: Name
          Value: !Sub "worker18.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceWorker19:
    DependsOn: [VPCGatewayAttachment]
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceWorkerImageId
      InstanceType: !Ref InstanceWorkerInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceWorker19
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      Tags:
        - Key: Name
          Value: !Sub "worker19.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceWorker20:
    DependsOn: [VPCGatewayAttachment]
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceWorkerImageId
      InstanceType: !Ref InstanceWorkerInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceWorker20
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      Tags:
        - Key: Name
          Value: !Sub "worker20.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceWorker21:
    DependsOn: [VPCGatewayAttachment]
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceWorkerImageId
      InstanceType: !Ref InstanceWorkerInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceWorker21
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      Tags:
        - Key: Name
          Value: !Sub "worker21.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InstanceWorker22:
    DependsOn: [VPCGatewayAttachment]
    Properties:
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: !Ref InstanceMasterVolumeSize
      IamInstanceProfile: !Ref InstanceProfile
      ImageId: !Ref InstanceWorkerImageId
      InstanceType: !Ref InstanceWorkerInstanceType
      PrivateIpAddress: !Ref PrivateIpAddressInstanceWorker22
      SecurityGroupIds:
        - !GetAtt VPC.DefaultSecurityGroup
        - !Ref SecurityGroup
      SubnetId: !Ref SubnetPublic
      Tags:
        - Key: Name
          Value: !Sub "worker22.${HostedZoneName}"
    Type: AWS::EC2::Instance

  InternetGateway:
    Type: AWS::EC2::InternetGateway

  KeyPair:
    Properties:
      KeyName: !Sub "KeyPair-${AWS::StackName}"
      PublicKeyMaterial: !Ref KeyPairPublicKeyMaterial
    Type: AWS::EC2::KeyPair

  RecordSetMaster00:
    DependsOn: [EIPMaster0]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'master00.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPMaster00
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetMaster01:
    DependsOn: [EIPMaster1]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'master01.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPMaster01
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetMaster02:
    DependsOn: [EIPMaster2]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'master02.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPMaster02
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetMaster03:
    DependsOn: [EIPMaster3]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'master03.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPMaster03
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetMaster04:
    DependsOn: [EIPMaster4]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'master04.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPMaster04
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetMaster05:
    DependsOn: [EIPMaster5]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'master05.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPMaster05
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetMaster06:
    DependsOn: [EIPMaster6]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'master06.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPMaster06
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetMaster07:
    DependsOn: [EIPMaster7]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'master07.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPMaster07
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetMaster08:
    DependsOn: [EIPMaster8]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'master08.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPMaster08
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetMaster09:
    DependsOn: [EIPMaster9]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'master09.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPMaster09
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetMaster10:
    DependsOn: [EIPMaster10]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'master10.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPMaster10
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetMaster11:
    DependsOn: [EIPMaster11]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'master11.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPMaster11
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetMaster12:
    DependsOn: [EIPMaster12]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'master12.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPMaster12
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetMaster13:
    DependsOn: [EIPMaster13]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'master13.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPMaster13
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetMaster14:
    DependsOn: [EIPMaster14]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'master14.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPMaster14
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetMaster15:
    DependsOn: [EIPMaster15]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'master15.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPMaster15
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetMaster16:
    DependsOn: [EIPMaster16]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'master16.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPMaster16
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetMaster17:
    DependsOn: [EIPMaster17]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'master17.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPMaster17
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetMaster18:
    DependsOn: [EIPMaster18]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'master18.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPMaster18
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetMaster19:
    DependsOn: [EIPMaster19]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'master19.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPMaster19
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetMaster20:
    DependsOn: [EIPMaster20]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'master20.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPMaster20
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetMaster21:
    DependsOn: [EIPMaster21]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'master21.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPMaster21
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetMaster22:
    DependsOn: [EIPMaster22]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'master22.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPMaster22
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetWorker00:
    DependsOn: [EIPWorker00]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'worker00.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPWorker00
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetWorker01:
    DependsOn: [EIPWorker01]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'worker01.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPWorker01
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetWorker02:
    DependsOn: [EIPWorker02]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'worker02.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPWorker02
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetWorker03:
    DependsOn: [EIPWorker03]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'worker03.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPWorker03
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetWorker04:
    DependsOn: [EIPWorker04]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'worker04.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPWorker04
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetWorker05:
    DependsOn: [EIPWorker05]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'worker05.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPWorker05
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetWorker06:
    DependsOn: [EIPWorker06]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'worker06.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPWorker06
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetWorker07:
    DependsOn: [EIPWorker07]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'worker07.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPWorker07
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetWorker08:
    DependsOn: [EIPWorker08]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'worker08.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPWorker08
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetWorker09:
    DependsOn: [EIPWorker09]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'worker09.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPWorker09
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetWorker10:
    DependsOn: [EIPWorker10]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'worker10.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPWorker10
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetWorker11:
    DependsOn: [EIPWorker11]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'worker11.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPWorker11
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetWorker12:
    DependsOn: [EIPWorker12]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'worker12.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPWorker12
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetWorker13:
    DependsOn: [EIPWorker13]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'worker13.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPWorker13
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetWorker14:
    DependsOn: [EIPWorker14]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'worker14.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPWorker14
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetWorker15:
    DependsOn: [EIPWorker15]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'worker15.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPWorker15
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetWorker16:
    DependsOn: [EIPWorker16]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'worker16.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPWorker16
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetWorker17:
    DependsOn: [EIPWorker17]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'worker17.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPWorker17
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetWorker18:
    DependsOn: [EIPWorker18]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'worker18.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPWorker18
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetWorker19:
    DependsOn: [EIPWorker19]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'worker19.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPWorker19
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetWorker20:
    DependsOn: [EIPWorker20]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'worker20.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPWorker20
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetWorker21:
    DependsOn: [EIPWorker21]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'worker21.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPWorker21
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  RecordSetWorker22:
    DependsOn: [EIPWorker22]
    Properties:
      HostedZoneName: !Sub '${HostedZoneName}.'
      Name: !Sub 'worker22.${HostedZoneName}'
      ResourceRecords:
        - !Ref EIPWorker22
      TTL: 300
      Type: A
    Type: AWS::Route53::RecordSet

  Role:
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          -
            Action:
              - sts:AssumeRole
            Effect: Allow
            Principal:
              Service:
                - ec2.amazonaws.com
        Version: 2012-10-17
      ManagedPolicyArns:
        - arn:aws:iam::aws:policy/AmazonSSMManagedInstanceCore
    Type: AWS::IAM::Role

  RoutePublic:
    DependsOn: [VPCGatewayAttachment]
    Properties:
      DestinationCidrBlock: 0.0.0.0/0
      GatewayId: !Ref InternetGateway
      RouteTableId: !Ref RouteTablePublic
    Type: AWS::EC2::Route

  RouteTablePublic:
    Properties:
      VpcId: !Ref VPC
    Type: AWS::EC2::RouteTable

  SecurityGroup:
    Properties:
      GroupDescription: Security Group to access via SSH the EC2 Instances
      SecurityGroupIngress:
        -
          CidrIp: !Ref SecurityGroupCidrIp
          FromPort: 22
          IpProtocol: tcp
          ToPort: 22
      VpcId: !Ref VPC
    Type: AWS::EC2::SecurityGroup

  SubnetPublic:
    Properties:
      AvailabilityZone:
        Fn::Select:
          - 0
          - Fn::GetAZs: !Ref 'AWS::Region'
      CidrBlock: !Ref SubnetCidrBlockPublic
      VpcId: !Ref VPC
    Type: AWS::EC2::Subnet

  SubnetRouteTableAssociationPublic:
    Properties:
      RouteTableId: !Ref RouteTablePublic
      SubnetId: !Ref SubnetPublic
    Type: AWS::EC2::SubnetRouteTableAssociation

  VPC:
    Properties:
      CidrBlock: !Ref VPCCidrBlock
    Type: "AWS::EC2::VPC"

  VPCGatewayAttachment:
    Properties:
      InternetGatewayId: !Ref InternetGateway
      VpcId: !Ref VPC
    Type: AWS::EC2::VPCGatewayAttachment
